# PDF转知识库PRD

## 1. 项目概述

### 1.1 项目背景
随着信息爆炸式增长，个人和团队面临知识管理挑战。大量PDF文档和markdown文件散落在各处，缺乏有效的归档和检索机制。为解决这一痛点，我们设计了一款基于大语言模型的多功能文档转知识库工具，能够将PDF、PPT和markdown文档自动转换为结构化markdown格式，便于后续知识管理。

### 1.2 产品定位
本产品是一款智能化的个人知识管理工具，专注于将PDF、PPT和markdown文档转换为结构化的markdown格式，便于用户建立个人知识库，提高信息检索效率。特别支持对markdown中包含的图片进行智能识别和内容提取，并提供图形化界面操作和异步任务处理功能。

### 1.3 目标用户
- 内容创作者
- 研究人员
- 学生
- 知识管理爱好者
- 需要处理大量PDF文档的专业人士
- 需要处理PPT演示文稿的专业人士
- 需要处理包含图片的markdown文档的用户

## 2. 产品功能

### 2.1 核心功能

#### 2.1.1 PDF文档转Markdown
- **功能描述**: 将PDF文件自动转换为结构化的markdown格式文档
- **输入**: PDF文档路径
- **输出**: 格式化markdown文档
- **实现方式**: 通过阿里云DashScope的qwen-plus模型进行内容理解和结构化转换
- **转换要求**: 保持原文档结构清晰，便于阅读和后续查阅

#### 2.1.2 Markdown文档转知识库
- **功能描述**: 读取markdown文档内容并进行知识库格式化处理
- **输入**: markdown文档路径(.md, .markdown)
- **处理逻辑**: 解析markdown内容，提取内嵌图片，对图片进行智能识别
- **输出格式**: 结构化markdown文档，包含图片描述信息

#### 2.1.3 PPT文档转Markdown
- **功能描述**: 将PPT和PPTX文件自动转换为结构化的markdown格式文档
- **输入**: PPT文档路径(.ppt, .pptx)
- **处理逻辑**: 解析PPT内容，提取每张幻灯片的文本内容和图片，对图片进行智能识别和分析
- **输出格式**: 结构化markdown文档，保持幻灯片结构并整合图片描述信息

#### 2.1.4 图片智能识别
- **功能描述**: 识别PDF、PPT和markdown文档中的图片内容并生成文字描述
- **输入**: PDF、PPT和markdown文档中的图片(本地或远程)
- **实现方式**: 使用阿里云DashScope的qwen-vl-plus视觉模型
- **输出**: 图片的文字描述，整合到markdown内容中
- **支持格式**: 本地图片文件和远程图片URL

#### 2.1.5 智能内容结构化
- **功能描述**: 通过大模型对PDF、PPT和markdown内容进行智能理解，自动识别章节、要点、列表等结构
- **处理逻辑**: 模型根据原文档的逻辑结构，生成对应的markdown格式
- **输出质量**: 确保转换后的文档结构清晰，便于后续检索和引用

#### 2.1.6 自定义提示词
- **功能描述**: 允许用户通过界面输入添加自定义提示词，控制转换风格和结构
- **实现方式**: 界面表单输入，可添加特定格式要求
- **使用场景**: 不同类型的文档可能需要不同的结构化方式

### 2.2 图形界面功能

#### 2.2.1 文件上传界面
- **功能描述**: 提供直观的文件上传界面
- **输入**: App Key, 个性化Prompt, PDF/markdown文件
- **交互方式**: 
  - 支持拖拽上传
  - 支持点击选择文件
  - 文件格式验证
  - 文件大小限制提示

#### 2.2.2 知识库管理界面
- **功能描述**: 展示所有处理过的文件记录
- **显示内容**:
  - 输入文件名
  - 输出文件名
  - 使用的个性化Prompt
  - 处理用时(秒)
  - 时间戳
- **操作功能**:
  - 下载处理后的文件
  - 在线查看文件内容

#### 2.2.3 任务管理界面
- **功能描述**: 展示异步转换任务的状态和进度
- **显示内容**:
  - 任务ID
  - 任务状态(等待中/处理中/已完成/失败)
  - 进度条显示
  - 任务详情
- **自动更新**: 界面自动刷新显示任务最新状态

#### 2.2.4 处理状态反馈
- **功能描述**: 实时显示处理进度和结果
- **反馈内容**:
  - 任务提交成功提示
  - 异步处理状态更新
  - 错误信息提示

### 2.3 异步任务处理功能

#### 2.3.1 任务队列管理
- **功能描述**: 管理多个转换任务的执行队列
- **实现方式**: 多线程任务处理机制
- **任务状态**: pending, processing, completed, failed

#### 2.3.2 进度跟踪
- **功能描述**: 实时跟踪每个任务的处理进度
- **进度显示**: 0% 到 100% 的进度条
- **状态更新**: 自动更新任务状态

#### 2.3.3 并发处理
- **功能描述**: 支持多个任务同时处理
- **实现方式**: 合理分配系统资源避免过载
- **队列机制**: 先进先出的任务处理顺序

### 2.4 辅助功能

#### 2.4.1 多格式支持
- **功能描述**: 支持处理PDF、PPT和markdown格式文件
- **支持格式**: PDF(.pdf), PPT(.ppt, .pptx), Markdown(.md, .markdown)

#### 2.4.2 批量处理
- **功能描述**: 支持批量处理多个文档
- **实现方式**: 通过界面多次上传或命令行工具

#### 2.4.3 配置管理
- **功能描述**: 支持配置文件管理API密钥和默认参数
- **配置项**:
  - `app_key`: DashScope API密钥
  - `default_prompt`: PDF文档的默认转换提示词
  - `default_markdown_prompt`: markdown文档的默认转换提示词
  - `default_ppt_prompt`: PPT文档的默认转换提示词
  - `output_dir`: 输出目录

#### 2.4.4 输出管理
- **功能描述**: 自动管理输出文件路径和命名
- **默认路径**: `{output_dir}/{input_name}_processed.md`
- **记录存储**: 处理记录保存在`.wucai/processing_records.json`文件中

## 3. 技术架构

### 3.1 前端技术
- **框架**: 原生HTML/CSS/JavaScript
- **界面特点**: 响应式设计，支持拖拽上传，标签式导航，异步任务状态展示

### 3.2 后端技术
- **框架**: Flask (Python Web框架)
- **功能模块**:
  - 文件上传处理
  - 命令行接口调用
  - 知识库记录管理
  - 文件下载/预览
  - 异步任务管理
  - 任务状态跟踪

### 3.3 异步处理架构
- **任务队列**: Python queue.Queue实现
- **多线程处理**: threading模块
- **状态管理**: 全局字典存储任务状态
- **进度跟踪**: 实时更新任务进度

### 3.4 核心依赖
- `PyPDF2`: PDF文档读取和解析
- `python-pptx`: PPT/PPTX文档读取和解析
- `dashscope`: 阿里云大模型API调用
- `Flask`: Web应用框架
- `argparse`: 命令行参数解析
- `re`: 正则表达式处理markdown图片链接
- `threading`: 多线程任务处理
- `queue`: 任务队列管理

### 3.5 系统架构
1. Web界面层：Flask应用提供HTTP服务
2. 任务队列层：管理待处理任务
3. 多线程处理层：并发执行转换任务
4. 文件上传处理层：接收文件并保存
5. 命令调用层：调用原命令行脚本处理文件
6. 文件类型检测模块：判断输入文件类型(PDF、PPT或markdown)
7. 内容读取模块：根据文件类型读取内容
8. 图片提取模块：从PPT/PPTX和markdown中提取图片链接
9. 图片识别模块：使用视觉模型识别图片内容
10. 内容整合模块：将图片描述整合到原文档
11. 模型调用模块：调用qwen-plus模型进行结构化转换
12. 记录管理模块：保存处理记录和元数据
13. 状态跟踪模块：实时更新任务状态和进度
14. 结果处理模块：保存转换结果到markdown文件

### 3.6 模型规格
- **文本模型**: qwen-plus
  - 最大输入: 128K tokens（约100万字符）
  - 最大输出: 8K tokens
  - 上下文长度: 128K tokens
- **视觉模型**: qwen-vl-plus
  - 图片识别: 支持本地和远程图片
  - 描述生成: 详细描述图片内容、文字、数据等元素

## 4. 用户界面

### 4.1 图形界面 (Web界面)
Web应用地址: `http://localhost:5000`

#### 4.1.1 侧边栏导航
- 现代化侧边栏设计，包含"主功能"、"任务管理"、"知识库"导航项
- 支持深色/浅色主题切换
- 响应式布局适配不同屏幕尺寸

#### 4.1.2 主功能页面
- 文件上传区域 (支持拖拽和点击选择)
- 支持格式: PDF, MD, MARKDOWN, PPT, PPTX
- App Key输入框 (密码类型，带显示/隐藏切换)
- 个性化Prompt文本框
- 提交转换任务按钮
- 实时任务进度反馈区域
- 文件信息展示

#### 4.1.3 任务管理页面
- 实时任务状态显示 (等待处理、处理中、处理完成、处理失败)
- 任务进度条可视化
- 详细任务信息 (开始时间、处理时长、输出字数、Token用量)
- 错误信息查看功能
- 下载和在线查看操作按钮
- 刷新功能

#### 4.1.4 知识库页面
- 处理记录表格显示
- 包含输入文件名、输出文件名、Prompt、处理时间、时间戳列
- Prompt一键复制功能
- 下载和在线查看操作按钮
- 刷新功能

#### 4.1.5 响应式设计
- 适配不同屏幕尺寸
- 直观的操作反馈
- 自动刷新任务状态
- 现代化UI组件和动画效果

### 4.2 命令行界面 (兼容)
```bash
python pdf_to_knowledge_md.py [OPTIONS] input_path
```

支持的输入格式：
- PDF文件: .pdf
- PPT文件: .ppt, .pptx
- Markdown文件: .md, .markdown

## 5. 配置管理

### 5.1 环境变量
- `DASHSCOPE_API_KEY`: DashScope API密钥（优先级最高）

### 5.2 配置文件
`.wucai/config.json`:
```json
{
  "app_key": "",
  "default_prompt": "请将以下PDF内容整理成适合作为个人知识库的markdown格式文档，要求结构清晰，便于阅读和后续查阅。",
  "default_markdown_prompt": "请将以下markdown内容整理成适合作为个人知识库的格式，要求结构清晰，保留原有格式，并将图片描述整合到内容中，便于阅读和后续查阅。",
  "default_ppt_prompt": "请将以下PPT内容整理成适合作为个人知识库的格式，要求保留幻灯片结构，提取关键知识点，并将图片内容整合到相应位置，便于阅读和后续查阅。",
  "output_dir": "./output"
}
```

### 5.3 处理记录文件
`.wucai/processing_records.json`:
```json
[
  {
    "input_file": "example.pdf",
    "unique_input_file": "uuid_example.pdf",
    "output_file": "uuid_example_processed.md",
    "prompt": "保持原有章节结构并添加标签",
    "timestamp": "2025-10-16 10:30:45",
    "processing_time": 15.23
  }
]
```

### 5.4 API密钥获取
API密钥优先级：
1. 界面输入
2. 环境变量 `DASHSCOPE_API_KEY`
3. 配置文件 `app_key`

## 6. 部署与运行

### 6.1 环境要求
- Python 3.7+
- pip包管理器

### 6.2 安装依赖
```bash
pip install -r requirements.txt
```

### 6.3 启动Web应用
```bash
python web_app.py
```

### 6.4 访问应用
启动后访问 `http://localhost:5000`

## 7. 项目结构

```
F:\wucai\20251015\
├── pdf_to_knowledge_md.py    # 主程序文件，支持PDF、PPT、markdown处理
├── web_app.py               # Web应用主文件(含异步任务处理)
├── init_config.py           # 初始化配置
├── requirements.txt         # 依赖管理
├── README.md               # 项目说明
├── pdf_to_md.bat          # Windows批处理脚本
├── test_markdown.md       # 测试markdown文件
├── AI大模型应用专家知识图谱-17期.pdf # 示例PDF
├── uploads/                # 上传文件存储目录
├── output/                 # 输出文件存储目录
├── templates/              # HTML模板目录
│   └── index.html         # 主界面模板(含任务管理)
└── .wucai/                 # 配置目录
    ├── config.json        # 配置文件
    └── processing_records.json # 处理记录文件
```

## 8. 风险与限制

### 8.1 技术限制
- PDF文档格式复杂性: 某些格式复杂的PDF可能转换效果不佳
- PPT文档格式复杂性: 某些格式复杂的PPT可能转换效果不佳
- markdown格式复杂性: 复杂的markdown格式可能影响图片提取
- 模型处理能力: 单次处理内容限制在128K tokens内
- 网络连接: 需要稳定的网络连接以调用API
- 图片处理限制: 每次只能处理单张图片，批量处理时可能增加处理时间
- 文件大小限制: Web上传有16MB限制
- 并发处理限制: 过多并发任务可能导致系统资源紧张
- PPT图片提取限制: 部分PPT中的复杂图形可能无法正确提取为图片

### 8.2 成本考虑
- API调用成本: 按token数量计费
- 长文档处理: 大型文档可能需要分割处理，增加API调用次数
- 图片识别成本: 每张图片的识别会增加额外的API调用费用

### 8.3 数据安全
- 上传内容: 文档内容和图片会上传到云端模型进行处理
- API密钥: 需要妥善保管API密钥
- 本地存储: 处理后的文件保存在本地output目录

## 9. 变更历史

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 1.7.0 | 2025-10-23 | - 重构前端布局：采用侧边栏导航的现代化布局设计<br>- 新增页面结构：实现主功能、任务管理、知识库独立页面<br>- 优化用户体验：改进界面布局、交互逻辑和视觉效果<br>- 增强响应式设计：适配不同设备的显示需求 | Wucai AI |
| 1.6.0 | 2025-10-21 | - 前端界面优化：实现现代化设计风格，支持深色/浅色主题切换<br>- 新增主题切换功能：用户可根据偏好选择界面主题<br>- 优化视觉设计：更新颜色方案、组件样式和交互效果<br>- 增强用户体验：改进响应式设计和交互反馈 | Wucai AI |
| 1.5.0 | 2025-10-21 | - 重构前端界面：主界面仅用于提交任务，任务管理独立为单独tab页<br>- 优化进度条显示：实现平滑递增的进度更新，解决跳变问题<br>- 增强任务管理：显示详细信息（开始时间、处理时长、输出字数等）<br>- 优化日志系统：运行日志按天存储在run-log/YYYYMMDD.log格式<br>- 增强知识库：添加Prompt列并支持一键复制功能 | Wucai AI |
| 1.4.4 | 2025-10-20 | - 优化表单状态保持：提交任务后保留App Key和Prompt<br>- 优化输出文件名：使输出文件名与输入文件名保持一致<br>- 添加Prompt复制功能：支持复制历史Prompt内容 | Wucai AI |
| 1.4.3 | 2025-10-20 | - 添加错误日志记录功能<br>- 实现错误日志存储和管理<br>- 添加错误报告下载功能<br>- 新增错误日志查看界面<br>- 优化界面UI和用户体验 | Wucai AI |
| 1.4.2 | 2025-10-20 | - 修复subprocess编码错误<br>- 解决PPT文件处理时的UnicodeDecodeError问题<br>- 更新web_app.py中subprocess调用以正确处理多字节字符 | Wucai AI |
| 1.4.1 | 2025-10-20 | - 修复PPT文件上传限制<br>- 更新前端HTML accept属性支持PPT格式<br>- 更新前端显示文本包含PPT格式支持说明 | Wucai AI |
| 1.4.0 | 2025-10-20 | - 新增PPT/PPTX文件支持<br>- 实现PPT内容提取功能<br>- 新增PPT图片识别功能<br>- 扩展文件上传支持PPT格式<br>- 添加PPT默认提示词配置<br>- 支持幻灯片结构保持和知识点提取 | Wucai AI |
| 1.3.0 | 2025-10-16 | - 新增异步任务处理功能<br>- 实现任务队列和多线程处理<br>- 添加任务状态实时更新<br>- 优化UI界面显示任务进度<br>- 提交任务后自动清空输入并提示到任务管理查看 | Wucai AI |
| 1.2.0 | 2025-10-16 | - 新增图形化界面<br>- 实现Web应用(Flask)<br>- 添加文件上传功能<br>- 实现知识库管理界面<br>- 添加处理记录功能(包含输入文件、prompt、处理时间、时间戳)<br>- 支持在线查看和下载输出文件 | Wucai AI |
| 1.1.0 | 2025-10-16 | - 新增markdown文件支持<br>- 新增图片识别功能<br>- 集成dashscope视觉模型<br>- 支持从markdown中提取并识别图片<br>- 添加图片描述到内容整合功能 | Wucai AI |
| 1.0.0 | 2025-10-16 | - 初始版本PRD<br>- 完成PDF转markdown核心功能<br>- 集成DashScope qwen-plus模型<br>- 支持命令行操作<br>- 添加配置管理功能 | Wucai AI |
| 0.9.0 | 2025-10-15 | - 项目初始化<br>- 基础PDF读取功能<br>- 原始API调用实现 | - |